import streamlit as st
import time
import uuid

# ==========================================
# ğŸ¨ é¡µé¢å…¨å±€é…ç½® (æ‰“é€  SaaS é«˜çº§æ„Ÿ)
# ==========================================
st.set_page_config(page_title="è€é¬¼æ•°å­—åŒ–ç”Ÿæ€æ²™ç›˜", page_icon="ğŸ£", layout="centered")

# ==========================================
# âš™ï¸ æ¨¡æ‹Ÿæ•°æ®ä¸å¼•æ“ (åå°é€»è¾‘ä¿æŒä¸å˜)
# ==========================================
def get_water_data(choice):
    if choice == "è€ç‹é«˜ç‚®é»‘å‘":
        return {"name": "è€ç‹é«˜ç‚®é»‘å‘", "temp": 8.5, "pressure": 990.0, "activity": 25, "status": "æå¯’åœå£"}
    else:
        return {"name": "åƒå²›æ¹–ç”Ÿæ€åŒº", "temp": 22.0, "pressure": 1015.0, "activity": 85, "status": "æ´»è·ƒçˆ†æŠ¤"}

# ==========================================
# ğŸ“± å‰ç«¯äº¤äº’ç•Œé¢ (GUI)
# ==========================================
st.title("ğŸ£ Fishing Pro 2026")
st.caption("è€é¬¼å‚é’“äº§ä¸šäº’è”ç½‘ â€”â€” æ•°å­—åŒ–ç”Ÿæ€å…¨é—­ç¯æ¼”ç¤ºèˆ±")
st.divider()

# ä½¿ç”¨ Session State æ¥æ§åˆ¶æ¼”ç¤ºæ­¥éª¤
if 'step' not in st.session_state:
    st.session_state.step = 1

# --- æ­¥éª¤ 1ï¼šæ•°å­—å­ªç”Ÿæ„ŸçŸ¥ ---
if st.session_state.step >= 1:
    st.subheader("ğŸ“ ç¬¬ä¸€å±‚ï¼šæ°´åŸŸæ•°å­—å­ªç”Ÿ (LBSæ„ŸçŸ¥)")
    
    # ç”¨æ¼‚äº®çš„å•é€‰æŒ‰é’®ä»£æ›¿ input
    loc_choice = st.radio("è¯·é€‰æ‹©æ¨¡æ‹Ÿä½œé’“æ°´åŸŸï¼š", ["è€ç‹é«˜ç‚®é»‘å‘", "åƒå²›æ¹–ç”Ÿæ€åŒº"], horizontal=True)
    water = get_water_data(loc_choice)
    
    # ä½¿ç”¨ Metric å¡ç‰‡å±•ç¤ºæ•°æ®ï¼Œæå…·å•†ä¸šçœ‹æ¿é£æ ¼
    col1, col2, col3 = st.columns(3)
    col1.metric("å®æ—¶æ°´æ¸©", f"{water['temp']} Â°C", "-5Â°C éª¤é™" if water['temp']<10 else "é€‚å®œ")
    col2.metric("å®æ—¶æ°”å‹", f"{water['pressure']} hPa", "ä½è¿·" if water['pressure']<1000 else "ç¨³å®š")
    col3.metric("å¼€å£æ´»è·ƒåº¦", f"{water['activity']}%", water['status'])
    
    # è¿›åº¦æ¡å±•ç¤ºæ´»è·ƒåº¦
    st.progress(water['activity'] / 100.0)
    
    if st.button("ä¸‹ä¸€æ­¥ï¼šå‘¼å« AI å†³ç­–å¼•æ“"):
        st.session_state.step = 2
        st.rerun()

# --- æ­¥éª¤ 2ï¼šAI é…æ–¹ä¸å±¥çº¦ ---
if st.session_state.step >= 2:
    st.divider()
    st.subheader("ğŸ§  ç¬¬äºŒå±‚ï¼šAI å¤§è„‘ä¸ O2O å±¥çº¦")
    
    with st.spinner("AI æ­£åœ¨è§£ææ°´æƒ…æ•°æ®å¹¶åŒ¹é…å‘¨è¾¹åº“å­˜..."):
        time.sleep(1.5) # æ¨¡æ‹Ÿè®¡ç®—å»¶è¿Ÿï¼Œå¢åŠ çœŸå®æ„Ÿ
        
    st.success("âœ… å®šåˆ¶é…æ–¹å·²ç”Ÿæˆï¼å‘¨è¾¹ 3km é—¨åº—åŒ¹é…æˆåŠŸã€‚")
    
    # ç”¨é†’ç›®çš„ä¿¡æ¯æ¡†å±•ç¤º SOP
    if water['temp'] < 10:
        st.warning("ğŸ‘‘ **æ¨èé…æ–¹**: çº¢è™«é£æš´(80%) + æè…¥ä¼´ä¾£(20%)\n\nğŸ’¡ **æ ‡å‡† SOP**: ã€ä¸“å®¶ä»‹å…¥ã€‘æå¯’åœå£æœŸï¼æ°´æ¯”ä¸¥æ ¼ 1:1ï¼Œé†’é¥µ 10 åˆ†é’Ÿã€‚æ­»é©¬å½“æ´»é©¬åŒ»ï¼")
    else:
        st.info("ğŸ‘‘ **æ¨èé…æ–¹**: 918Â·é‡æˆ˜ç¯‡(60%) + é€Ÿæ”»2å·(40%)\n\nğŸ’¡ **æ ‡å‡† SOP**: ã€å¸¸è§„ SOPã€‘æ°”æ¸©é€‚å®œï¼Œå»ºè®®æ°´æ¯” 1:1.1ï¼Œæ­£å¸¸æ“é¥µä½œé’“ã€‚")
        
    st.write(f"ğŸ§¾ **æ¨¡æ‹Ÿè®¢å•**: `ORD-{uuid.uuid4().hex[:6].upper()}` | é—¨åº—: è€é¬¼æ——èˆ°åº— | çŠ¶æ€: éª‘å£«å·²æ¥å•")
    
    if st.button("æ¨¡æ‹Ÿä½œé’“ 6 å°æ—¶å..."):
        st.session_state.step = 3
        st.rerun()

# --- æ­¥éª¤ 3ï¼šæ•°æ®é£è½®ä¸ ESG ---
if st.session_state.step >= 3:
    st.divider()
    st.subheader("â™»ï¸ ç¬¬ä¸‰å±‚ï¼šå®æˆ˜æ‰“ç‚¹ä¸ç”Ÿæ€ä»·å€¼ (ESG)")
    
    st.write("ğŸ“± **APP å¼¹çª—**ï¼šä»Šå¤©é’“å¾—æ€ä¹ˆæ ·ï¼Ÿ")
    colA, colB = st.columns(2)
    with colA:
        if st.button("ğŸ‘ çˆ†æŠ¤äº†ï¼è¿™é…æ–¹ç»äº†"):
            st.toast("ğŸ“ˆ æ¨¡å‹å·²å¼ºåŒ–ï¼é…æ–¹æƒé‡ä¸Šå‡ã€‚") # å³ä¸‹è§’å¼¹å‡ºæç¤º
            st.session_state.feedback = "boom"
    with colB:
        if st.button("ğŸ‘ ç©ºå†›äº†ï¼Œä»€ä¹ˆç ´ç©æ„å„¿"):
            st.toast("ğŸ“‰ è§¦å‘ç ”å‘è­¦æŠ¥ï¼é…æ–¹æƒé‡ä¸‹è°ƒã€‚")
            st.session_state.feedback = "blank"
            
    st.write("ğŸŒ… å‡†å¤‡æ”¶ç«¿å›å®¶ï¼Œèµ°ä¹‹å‰è¦åšç‚¹ä»€ä¹ˆï¼Ÿ")
    if st.button("ğŸ“¸ æ¸…ç†é’“ä½åƒåœ¾å¹¶æ‹ç…§ä¸Šä¼ "):
        with st.spinner("AI è§†è§‰æ ¸éªŒä¸­..."):
            time.sleep(1)
        st.balloons() # æ»¡å±æ°”çƒç‰¹æ•ˆï¼Œæå…¶é€‚åˆæ¼”ç¤ºæ‰“åŠ¨å…¨åœº
        st.success("ğŸ‰ æ ¸éªŒé€šè¿‡ï¼è·å¾— 20 è€é¬¼ç”Ÿæ€ç§¯åˆ†ï¼æœ¬æ¬¡è¡Œä¸ºå·²åŒæ­¥è‡³ã€ä¸­å›½å†…é™†æ°´åŸŸç”Ÿæ€ç›‘æµ‹ç½‘ã€‘ã€‚")
        
    if st.button("ğŸ”„ é‡æ–°æ¼”ç¤º"):
        st.session_state.step = 1
        st.rerun()
